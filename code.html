<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Traffic Light Simulation</title>
  <style>
    body {
      background: #1e1e2f;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .btn {
      padding: 10px 20px;
      margin: 10px 5px;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .start { background: #2ecc71; color: white; }
    .stop { background: #e74c3c; color: white; }
    .reset { background: #3498db; color: white; }

    .traffic-feed {
      display: inline-block;
      width: 45%;
      padding: 20px;
      background: #2c2c3f;
      margin: 10px;
      border-radius: 10px;
      vertical-align: top;
    }

    .indicator {
      margin-top: 10px;
    }

    .light {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 10px;
    }

    .green { background: #2ecc71; }
    .red { background: #e74c3c; }

    .vehicle {
      display: inline-block;
      width: 10px;
      height: 10px;
      margin: 2px;
      border-radius: 2px;
    }

    .vehicle.go { background: #3498db; }
    .vehicle.stop { background: red; }

    #violationLog {
      margin-top: 20px;
      background: #3c3c4f;
      padding: 10px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <h1>ðŸš¦ Intelligent Traffic Light Controller</h1>
  <p>Simulation with vehicle count, emergency detection, and violation logging.</p>

  <button class="btn start" onclick="startSimulation()">Start</button>
  <button class="btn stop" onclick="stopSimulation()">Stop</button>
  <button class="btn reset" onclick="resetSimulation()">Reset</button>

  <div id="feeds">
    <div class="traffic-feed" id="feed1">
      <h2>Feed 1</h2>
      <div class="indicator">
        <span id="light1" class="light red"></span>
        <span id="status1">STOP</span>
      </div>
      <div id="vehicles1"></div>
      <p id="emergency1">Emergency: None</p>
    </div>

    <div class="traffic-feed" id="feed2">
      <h2>Feed 2</h2>
      <div class="indicator">
        <span id="light2" class="light red"></span>
        <span id="status2">STOP</span>
      </div>
      <div id="vehicles2"></div>
      <p id="emergency2">Emergency: None</p>
    </div>
  </div>

  <div id="violationLog">
    <h3>Violations</h3>
    <ul id="violationsList"></ul>
  </div>

  <script>
    let intervalId = null;
    let activeLight = null;
    let violationCount = 0;

    function randomBool(probability = 0.2) {
      return Math.random() < probability;
    }

    function simulateFeed() {
      const feed1 = {
        count: Math.floor(Math.random() * 20),
        hasEmergency: randomBool(0.15),
        emergencyType: Math.random() > 0.5 ? 'ambulance' : 'police'
      };

      const feed2 = {
        count: Math.floor(Math.random() * 20),
        hasEmergency: randomBool(0.15),
        emergencyType: Math.random() > 0.5 ? 'ambulance' : 'police'
      };

      updateUI(feed1, feed2);
    }

    function updateUI(feed1, feed2) {
      // Decide traffic light control
      if (feed1.hasEmergency) {
        activeLight = 1;
      } else if (feed2.hasEmergency) {
        activeLight = 2;
      } else if (feed1.count > feed2.count) {
        activeLight = 1;
      } else if (feed2.count > feed1.count) {
        activeLight = 2;
      } else {
        activeLight = null;
      }

      // Update Feed 1
      document.getElementById("vehicles1").innerHTML = "";
      for (let i = 0; i < feed1.count; i++) {
        const v = document.createElement("div");
        v.className = "vehicle " + (activeLight === 1 ? "go" : "stop");
        document.getElementById("vehicles1").appendChild(v);
      }

      document.getElementById("emergency1").innerText = feed1.hasEmergency ? Emergency: ${feed1.emergencyType} : "Emergency: None";
      document.getElementById("light1").className = "light " + (activeLight === 1 ? "green" : "red");
      document.getElementById("status1").innerText = activeLight === 1 ? "GO" : "STOP";

      // Update Feed 2
      document.getElementById("vehicles2").innerHTML = "";
      for (let i = 0; i < feed2.count; i++) {
        const v = document.createElement("div");
        v.className = "vehicle " + (activeLight === 2 ? "go" : "stop");
        document.getElementById("vehicles2").appendChild(v);
      }

      document.getElementById("emergency2").innerText = feed2.hasEmergency ? Emergency: ${feed2.emergencyType} : "Emergency: None";
      document.getElementById("light2").className = "light " + (activeLight === 2 ? "green" : "red");
      document.getElementById("status2").innerText = activeLight === 2 ? "GO" : "STOP";

      // Violation detection
      if (activeLight !== 1 && feed1.count > 0 && !feed1.hasEmergency) {
        logViolation(1, feed1.count);
      }

      if (activeLight !== 2 && feed2.count > 0 && !feed2.hasEmergency) {
        logViolation(2, feed2.count);
      }
    }

    function logViolation(feedNumber, count) {
      violationCount++;
      const li = document.createElement("li");
      li.innerText = [${new Date().toLocaleTimeString()}] Feed ${feedNumber}: ${count} vehicle(s) ran red light;
      document.getElementById("violationsList").prepend(li);
    }

    function startSimulation() {
      if (!intervalId) {
        simulateFeed(); // run immediately
        intervalId = setInterval(simulateFeed, 3000);
      }
    }

    function stopSimulation() {
      clearInterval(intervalId);
      intervalId = null;
    }

    function resetSimulation() {
      stopSimulation();
      document.getElementById("vehicles1").innerHTML = "";
      document.getElementById("vehicles2").innerHTML = "";
      document.getElementById("violationsList").innerHTML = "";
      document.getElementById("emergency1").innerText = "Emergency: None";
      document.getElementById("emergency2").innerText = "Emergency: None";
      document.getElementById("light1").className = "light red";
      document.getElementById("light2").className = "light red";
      document.getElementById("status1").innerText = "STOP";
      document.getElementById("status2").innerText = "STOP";
      violationCount = 0;
    }
  </script>
</body>
</html>